<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Fang den Frosch! 🐸</title>
    <meta
      name="description"
      content="Entwickelt als Teil eines Frontend-Entwickler-Portfolios: 'Fang den Frosch!' ist ein spannendes Reaktionsspiel, um die Geschicklichkeit des Spielers zu testen. Erlebe eine moderne, mobil-freundliche Webanwendung, die mit HTML, CSS und JavaScript umgesetzt wurde."
    />
    <link rel="stylesheet" href="css/style.css" />
  </head>
  <body>
    <main>
      <h1>Fang den Frosch! 🐸</h1>

      <div class="teich">
        <div class="game-info">
          <span id="score">Punkte: 0</span>
          <span id="timer">Zeit: 30s</span>
        </div>
        <div id="game-board">
          <div class="hole" id="hole0" onclick="hit(0)"></div>
          <div class="hole" id="hole1" onclick="hit(1)"></div>
          <div class="hole" id="hole2" onclick="hit(2)"></div>
          <div class="hole" id="hole3" onclick="hit(3)"></div>
          <div class="hole" id="hole4" onclick="hit(4)"></div>
          <div class="hole" id="hole5" onclick="hit(5)"></div>
          <div class="hole" id="hole6" onclick="hit(6)"></div>
          <div class="hole" id="hole7" onclick="hit(7)"></div>
          <div class="hole" id="hole8" onclick="hit(8)"></div>
        </div>
      </div>

      <div id="end-message"></div>

      <p><button onclick="startGame()">Spiel starten</button></p>

      <p>
        <input
          type="radio"
          id="difficult-easy"
          name="difficulty"
          value="leicht"
        />Leicht
        <input
          type="radio"
          id="difficult-medium"
          name="difficulty"
          value="mittel"
          checked
        />Mittel
        <input
          type="radio"
          id="difficult-heavy"
          name="difficulty"
          value="schwer"
        />Schwer
      </p>
    </main>

    <footer class="footer">
      <div class="footer-content">&copy; 2025 Frederik Anspach</div>
    </footer>

    <script>
      let score = 0;
      let timeLeft = 30;
      let frogInterval;
      let timerInterval;
      let isGameActive = false; // Status für das Spiel
      let setHoles = [];
      let cloverHoles = []; // Neues Array zur Speicherung der Kleeblatt-Löcher

      const gameElements = [
        { symbol: "🧜🏻‍♀️", name: "Meerjungfrau", points: 5, probability: 0.05 },
        { symbol: "🐟", name: "Fisch", points: 2, probability: 0.05 },
        { symbol: "🦆", name: "Ente", points: 2, probability: 0.05 },
        { symbol: "🐸", name: "Frosch", points: 1, probability: 0.7 },
        { symbol: "🐡", name: "Kugelfisch", points: -2, probability: 0.05 },
        { symbol: "🦀", name: "Krebs", points: -2, probability: 0.05 },
        { symbol: "🐊", name: "Krokodil", points: -5, probability: 0.05 },
      ];
      const fourLeafCloverSymbol = "🍀";
      const cloverSymbol = "☘️";
      const cloverProbability = 0.4;
      const maxAdditionalCloves = 2;

      let currentActiveElement = null;

      const hitSounds = [
        new Audio("media/frog-hit.mp3"),
        new Audio("media/frog-hit.mp3"),
        new Audio("media/frog-hit.mp3"),
        new Audio("media/frog-hit.mp3"),
        new Audio("media/frog-hit.mp3"),
      ];
      let soundIndex = 0;

      const difficultySettings = {
        leicht: 2000,
        mittel: 1000,
        schwer: 600,
      };

      function getRandomElementByProbability() {
        const rand = Math.random();
        let cumulativeProbability = 0;
        for (let i = 0; i < gameElements.length; i++) {
          cumulativeProbability += gameElements[i].probability;
          if (rand < cumulativeProbability) {
            return gameElements[i];
          }
        }
        return gameElements[Math.floor(Math.random() * gameElements.length)];
      }

      function startGame() {
        if (isGameActive) return;

        isGameActive = true;
        score = 0;
        timeLeft = 30;
        currentActiveElement = null;
        setHoles = [];
        cloverHoles = []; // Leere auch das neue Array

        document.getElementById("end-message").textContent = "";
        document.getElementById("score").textContent = "Punkte: 0";
        document.getElementById("timer").textContent = `Zeit: ${timeLeft}s`;

        const intervalTimer = selectDifficult();
        frogInterval = setInterval(showElements, intervalTimer);
        timerInterval = setInterval(updateTime, 1000);
      }

      function selectDifficult() {
        const selectedRadio = document.querySelector(
          'input[name="difficulty"]:checked'
        );
        return difficultySettings[selectedRadio.value];
      }

      function showElements() {
        if (!isGameActive) return;

        // Leere alle vorherigen Löcher
        hideElement();

        // Schritt 1: Haupt-Element platzieren
        let availableHoles = [0, 1, 2, 3, 4, 5, 6, 7, 8];

        const mainHoleIndexInAvailable = Math.floor(
          Math.random() * availableHoles.length
        );
        const mainHole = availableHoles[mainHoleIndexInAvailable];
        availableHoles.splice(mainHoleIndexInAvailable, 1);

        const selectedElement = getRandomElementByProbability();
        currentActiveElement = { ...selectedElement, hole: mainHole };
        setHoles.push(mainHole); // Füge das Haupt-Loch zu setHoles hinzu

        document.getElementById("hole" + mainHole).textContent =
          selectedElement.symbol;

        // Schritt 2: Kleeblätter auf zufällige freie Felder verteilen
        let numClovesToAdd = 0;
        if (Math.random() < cloverProbability) {
          numClovesToAdd = Math.floor(
            Math.random() * (maxAdditionalCloves + 1)
          );
        }

        for (let i = 0; i < numClovesToAdd; i++) {
          if (availableHoles.length > 0) {
            const randomHoleIndexInAvailable = Math.floor(
              Math.random() * availableHoles.length
            );
            const cloverHole = availableHoles[randomHoleIndexInAvailable];

            const cloverSymbolToUse =
              Math.random() < 0.5 ? fourLeafCloverSymbol : cloverSymbol;
            document.getElementById("hole" + cloverHole).textContent =
              cloverSymbolToUse;

            cloverHoles.push(cloverHole); // Füge das Kleeblatt-Loch zum neuen Array hinzu
            availableHoles.splice(randomHoleIndexInAvailable, 1);
          }
        }
      }

      function hideElement() {
        // Leere das Haupt-Element
        if (currentActiveElement) {
          document.getElementById(
            "hole" + currentActiveElement.hole
          ).textContent = "";
        }
        currentActiveElement = null;

        // Leere alle Kleeblätter
        for (const hole of cloverHoles) {
          document.getElementById("hole" + hole).textContent = "";
        }
        cloverHoles = [];
      }

      function hit(index) {
        if (!isGameActive) return;

        // Prüfe, ob das Haupt-Element getroffen wurde
        if (currentActiveElement && index === currentActiveElement.hole) {
          score += currentActiveElement.points;
          document.getElementById("score").textContent = `Punkte: ${score}`;
          hideElement();
          hitSounds[soundIndex].play();
          soundIndex = (soundIndex + 1) % hitSounds.length;
        }
        // Ansonsten: Prüfe, ob ein Kleeblatt getroffen wurde
        else if (cloverHoles.includes(index)) {
          hideElement();
          hitSounds[soundIndex].play();
          soundIndex = (soundIndex + 1) % hitSounds.length;
        }
      }

      function updateTime() {
        timeLeft--;
        document.getElementById("timer").textContent = `Zeit: ${timeLeft}s`;

        if (timeLeft <= 0) {
          isGameActive = false;
          clearInterval(frogInterval);
          clearInterval(timerInterval);

          hideElement();

          document.getElementById(
            "end-message"
          ).textContent = `Spiel vorbei! Du hast ${score} Punkte!`;
        }
      }
    </script>
  </body>
</html>
